<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Enterprise Library Data Access Application Block: Data Access Application Block User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="entlib_new_icon_100x100.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Enterprise Library Data Access Application Block
   &#160;<span id="projectnumber">7.0-rc1</span>
   </div>
   <div id="projectbrief">The Data Access Application Block abstracts the actual database you are using, and exposes a collection of methods that make it easy to access that database and to perform common tasks.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a00940.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Data Access Application Block User Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md1">What is the Data Access Application Block</a></li>
<li class="level2"><a href="#autotoc_md2">NuGet Packages</a></li>
<li class="level2"><a href="#autotoc_md3">Configuration</a><ul><li class="level3"><a href="#autotoc_md4">Oracle Configuration</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md5">Code Examples</a><ul><li class="level3"><a href="#autotoc_md6">Creating Database Instances</a></li>
<li class="level3"><a href="#autotoc_md7">Reading Rows Using a Query with No Parameters</a></li>
<li class="level3"><a href="#autotoc_md8">Reading Rows Using a Query with unnamed Parameters</a></li>
<li class="level3"><a href="#autotoc_md9">Reading Rows Using a Query with named Parameters</a></li>
<li class="level3"><a href="#autotoc_md10">Retrieving Data as Objects</a></li>
</ul>
</li>
</ul>
</ul>
</div>
<div class="textblock"><p>This guide shows how to use the Enterprise Library Data Access Application Block (DAAB for short) version 7.0. For a guide to version 6.0, see the <a href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/dn440726(v=pandp.60)">original documentation by Microsoft</a>.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
What is the Data Access Application Block</h2>
<p>The Data Access Application Block abstracts the actual database you are using, and exposes a collection of methods that make it easy to access that database and to perform common tasks. The block is designed to simplify the task of calling stored procedures, but it also provides full support for the use of parameterized SQL statements.</p>
<p>In other words, the Data Access Application Block provides access to the most often used features of ADO.NET in simple-to-use classes and provides a corresponding boost to developer productivity.</p>
<p>In addition to the more common approaches familiar to users of ADO.NET, the Data Access block also exposes techniques for asynchronous data access for databases that support this feature using the Asynchronous Programming Model (TPL coming in the near future), and provides the ability to return data as a sequence of objects suitable for client-side querying using techniques such as Language Integrated Query (LINQ).</p>
<p>However, the block is not intended to be an Object/Relational Mapping (O/RM) solution. Although it uses mappings to relate parameters and relational data with the properties of objects, but does not implement an O/RM modeling solution.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
NuGet Packages</h2>
<p>DAAB is composed of a base package, called <a href="https://www.nuget.org/packages/EnterpriseLibrary.Data.NetCore/">EnterpriseLibrary.Data.NetCore</a>, and several other packages which support specific database engines. For databases which are not directly supported by DAAB, only the base package is needed. The database-specific packages support unique features of those systems.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Supported Database   </th><th class="markdownTableHeadNone">Package   </th><th class="markdownTableHeadNone">.NET Framework support    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Generic   </td><td class="markdownTableBodyNone">EnterpriseLibrary.Data.NetCore   </td><td class="markdownTableBodyNone">.NET 4.5.2, 4.6, 4.7; .NET Core 2.1, 3.1; .NET Standard 2.0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">OLE DB   </td><td class="markdownTableBodyNone">EnterpriseLibrary.Data.OleDb.NetCore   </td><td class="markdownTableBodyNone">.NET 4.5.2, 4.6, 4.7; .NET Core 2.1, 3.1; .NET Standard 2.0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SQL Server   </td><td class="markdownTableBodyNone">EnterpriseLibrary.Data.SqlServer.NetCore   </td><td class="markdownTableBodyNone">.NET 4.5.2, 4.6, 4.7; .NET Core 2.1, 3.1; .NET Standard 2.0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Oracle   </td><td class="markdownTableBodyNone">EnterpriseLibrary.Data.Oracle.NetCore   </td><td class="markdownTableBodyNone">.NET 4.5.2, 4.6, 4.7; .NET Core 2.1, 3.1; .NET Standard 2.0    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ODBC   </td><td class="markdownTableBodyNone">EnterpriseLibrary.Data.Odbc.NetCore   </td><td class="markdownTableBodyNone">.NET 4.5.2, 4.6, 4.7; .NET Core 2.1, 3.1; .NET Standard 2.0    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SQL Server CE   </td><td class="markdownTableBodyNone">EnterpriseLibrary.Data.SqlCe.NetCore   </td><td class="markdownTableBodyNone">.NET 4.5.2, 4.6, 4.7   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md3"></a>
Configuration</h2>
<p>After installing the appropriate package(s), you should add the following configuration elements to your app.config or web.config file.</p><ol type="1">
<li>Under the <code>&lt;configSections&gt;</code> element, add the following section: <div class="fragment"><div class="line">&lt;<span class="keywordtype">section</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;dataConfiguration&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Microsoft.Practices.EnterpriseLibrary.Data.Configuration.DatabaseSettings, Microsoft.Practices.EnterpriseLibrary.Data&quot;</span> /&gt;</div>
</div><!-- fragment --></li>
<li>Under the <code>&lt;connectionStrings&gt;</code> section, add a normal connection string to your database, with a <code>name</code>, <code>connectionString</code> and <code>providerName</code> attributes. DAAB supports the following provider names:<ol type="a">
<li><code>System.Data.SqlClient</code> (.NET built-in provider for SQL Server)</li>
<li><code>Oracle.ManagedDataAccess.Client</code> (Managed ADO.NET provider by Oracle, known as ODP.NET)</li>
<li><code>System.Data.OleDb</code></li>
<li><code>System.Data.Odbc</code></li>
<li><code>System.Data.SqlServerCe.4.0</code> (Latest provider for SQL Server CE, available as a NuGet package)</li>
</ol>
</li>
<li>Under the root <code>&lt;configuration&gt;</code> element, but somewhere bellow the <code>&lt;configSections&gt;</code>, add the following section: <div class="fragment"><div class="line">&lt;<span class="keywordtype">dataConfiguration</span> <span class="keyword">defaultDatabase</span>=<span class="stringliteral">&quot;MyConnectionString&quot;</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">dataConfiguration</span>&gt;</div>
</div><!-- fragment --> The <code>defaultDatabase</code> attribute points to the <code>name</code> of the connection string above. In code, you can direct DAAB to use a different connection string.</li>
<li>Under the <code>&lt;dataConfiguration&gt;</code> add the following section: <div class="fragment"><div class="line">&lt;<span class="keywordtype">providerMappings</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">add</span> <span class="keyword">databaseType</span>=<span class="stringliteral">&quot;&quot;</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;&quot;</span> /&gt;</div>
<div class="line">&lt;/<span class="keywordtype">providerMappings</span>&gt;</div>
</div><!-- fragment --><ol type="a">
<li><code>name</code> is a provider name, as listed above in section 2.</li>
<li><code>databaseType</code> is one of the following types:</li>
</ol>
</li>
</ol>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Database   </th><th class="markdownTableHeadNone">databaseType    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Generic   </td><td class="markdownTableBodyNone">"Microsoft.Practices.EnterpriseLibrary.Data.GenericDatabase, Microsoft.Practices.EnterpriseLibrary.Data"    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SQL Server CE   </td><td class="markdownTableBodyNone">"Microsoft.Practices.EnterpriseLibrary.Data.SqlCe.SqlCeDatabase, Microsoft.Practices.EnterpriseLibrary.Data.SqlCe"    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Oracle   </td><td class="markdownTableBodyNone">"Microsoft.Practices.EnterpriseLibrary.Data.Oracle.OracleDatabase, Microsoft.Practices.EnterpriseLibrary.Data.Oracle"    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SQL Server   </td><td class="markdownTableBodyNone">"Microsoft.Practices.EnterpriseLibrary.Data.Sql.SqlDatabase, Microsoft.Practices.EnterpriseLibrary.Data.SqlServer"    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">OLE DB   </td><td class="markdownTableBodyNone">"Microsoft.Practices.EnterpriseLibrary.Data.OleDb.OleDbDatabase, Microsoft.Practices.EnterpriseLibrary.Data.OleDb"    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ODBC   </td><td class="markdownTableBodyNone">"Microsoft.Practices.EnterpriseLibrary.Data.Odbc.OdbcDatabase, Microsoft.Practices.EnterpriseLibrary.Data.Odbc"   </td></tr>
</table>
<p>You can add multiple mappings if you access more than one database type.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
Oracle Configuration</h3>
<p>For Oracle databases, we also need to configure packages.</p><ol type="1">
<li>Under <code>&lt;configSections&gt;</code>, in addition to the <code>dataConfiguration</code> section, add <div class="fragment"><div class="line">&lt;<span class="keywordtype">section</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;oracleConnectionSettings&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;Microsoft.Practices.EnterpriseLibrary.Data.Oracle.Configuration.OracleConnectionSettings, Microsoft.Practices.EnterpriseLibrary.Data.Oracle&quot;</span> /&gt;</div>
</div><!-- fragment --></li>
<li>Under the root <code>&lt;configuration&gt;</code> element, but somewhere bellow the <code>&lt;configSections&gt;</code>, add the following section: <div class="fragment"><div class="line">&lt;<span class="keywordtype">oracleConnectionSettings</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">add</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;OracleTest&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">packages</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">add</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ENTLIBTEST&quot;</span> <span class="keyword">prefix</span>=<span class="stringliteral">&quot;GetProductDetailsById&quot;</span> /&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">packages</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">add</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">oracleConnectionSettings</span>&gt;</div>
</div><!-- fragment --><ol type="a">
<li>The <code>name</code> attribute in the <code>&lt;add&gt;</code> element points to the name of a connection string from section 2 above.</li>
<li>in each package, the <code>name</code> in the <code>&lt;add&gt;</code> element is a package name, which will be prefixed to the stored procedure specified in the <code>prefix</code> attribute.</li>
</ol>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md5"></a>
Code Examples</h2>
<h3><a class="anchor" id="autotoc_md6"></a>
Creating Database Instances</h3>
<p>The simplest approach for creating a <code>Database</code> object or one of its descendants is calling the <code>CreateDefault</code> or <code>Create</code> method of the <code>DatabaseProviderFactory</code> class, as shown here, and storing these instances in application-wide variables so that they can be accessed from anywhere in the code. </p><div class="fragment"><div class="line"><span class="comment">// Configure the DatabaseFactory to read its configuration from the .config file</span></div>
<div class="line">DatabaseProviderFactory factory = <span class="keyword">new</span> DatabaseProviderFactory();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create the default Database object from the factory.</span></div>
<div class="line"><span class="comment">// The actual concrete type is determined by the configuration settings.</span></div>
<div class="line">Database defaultDB = factory.CreateDefault();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a Database object from the factory using the connection string name.</span></div>
<div class="line">Database namedDB = factory.Create(<span class="stringliteral">&quot;ExampleDatabase&quot;</span>);</div>
</div><!-- fragment --><p> where "ExampleDatabase" is a <code>name</code> of a connection string. With <code>CreateDefault</code>, the connection string specified by the <code>defaultDatabase</code> attribute of the <code>dataConfiguration</code> element in web.config is used, as described above. Using the default database is a useful approach because you can change which of the databases defined in your configuration is the default simply by editing the configuration file, without requiring recompilation or redeployment of the application.</p>
<p>Some features are only available in the concrete types for a specific database. For example, the <code>ExecuteXmlReader</code> method is only available in the <code>SqlDatabase</code> class. If you want to use such features, you must cast the database type you instantiate to the appropriate concrete type.</p>
<p>As alternative to using the <code>DatabaseProviderFactory</code> class, you could use the static <code>DatabaseFactory</code> façade to create your <code>Database</code> instances. You must invoke the <code>SetDatabaseProviderFactory</code> method to set the details of the default database from the configuration file.</p>
<div class="fragment"><div class="line">DatabaseFactory.SetDatabaseProviderFactory(factory, <span class="keyword">false</span>);</div>
<div class="line">defaultDB = DatabaseFactory.CreateDatabase(<span class="stringliteral">&quot;ExampleDatabase&quot;</span>);</div>
<div class="line"><span class="comment">// Uses the default database from the configuration file.</span></div>
<div class="line">sqlServerDB = DatabaseFactory.CreateDatabase() as SqlDatabase;</div>
</div><!-- fragment --><p>In addition to using configuration to define the databases you will use, the Data Access block allows you to create instances of concrete types that inherit from the Database class directly in your code, as shown here.</p>
<div class="fragment"><div class="line">SqlDatabase sqlDatabase = <span class="keyword">new</span> SqlDatabase(myConnectionString);</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md7"></a>
Reading Rows Using a Query with No Parameters</h3>
<p>To read rows using a stored procedure with no parameters, retrieve an <code>IDataReader</code> and read values from it: </p><div class="fragment"><div class="line"><span class="comment">// Call the ExecuteReader method by specifying just the stored procedure name.</span></div>
<div class="line"><span class="keyword">using</span> (IDataReader reader = namedDB.ExecuteReader(<span class="stringliteral">&quot;MyStoredProcName&quot;</span>))</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Use the values in the rows as required.</span></div>
<div class="line">    DisplayRowValues(reader);</div>
<div class="line">}</div>
</div><!-- fragment --><p> <code>ExecuteReader</code> also accept a <code>CommandType</code>, but the default value is <code>CommandType.StoredProcedure</code>.</p>
<p>To use an inline SQL statement, specify a <code>CommandType.Text</code>: </p><div class="fragment"><div class="line"><span class="comment">// Call the ExecuteReader method by specifying the command type</span></div>
<div class="line"><span class="comment">// as a SQL statement, and passing in the SQL statement.</span></div>
<div class="line"><span class="keyword">using</span> (IDataReader reader = namedDB.ExecuteReader(CommandType.Text, <span class="stringliteral">&quot;SELECT TOP 1 * FROM OrderList&quot;</span>))</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Use the values in the rows as required - here we are just displaying them.</span></div>
<div class="line">    DisplayRowValues(reader);</div>
<div class="line">}</div>
</div><!-- fragment --><p>You read the values from the <code>IDataReader</code> normally: </p><div class="fragment"><div class="line"><span class="keyword">private</span> <span class="keywordtype">void</span> DisplayRowValues(IDataReader reader)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">while</span> (reader.Read())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; reader.FieldCount; i++)</div>
<div class="line">        {</div>
<div class="line">            Console.WriteLine(<span class="stringliteral">&quot;{0} = {1}&quot;</span>, reader.GetName(i), reader[i].ToString());</div>
<div class="line">        }</div>
<div class="line">        Console.WriteLine();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md8"></a>
Reading Rows Using a Query with unnamed Parameters</h3>
<p>If you use only input parameters, you can pass their values to the stored procedure or SQL statement directly and let the <code>Database</code> class wrap them in the appropriate <code>DbParameter</code> objects. You must pass them in the same order as they are expected by the query, because you are not using names for these parameters. The following code executes a stored procedure that takes a single string parameter. </p><div class="fragment"><div class="line"><span class="comment">// Call the ExecuteReader method with the stored procedure</span></div>
<div class="line"><span class="comment">// name and an Object array containing the parameter values.</span></div>
<div class="line"><span class="keyword">using</span> (IDataReader reader = defaultDB.ExecuteReader(<span class="stringliteral">&quot;ListOrdersByState&quot;</span>, <span class="stringliteral">&quot;Colorado&quot;</span>))</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Use the values in the rows as required - here we are just displaying them.</span></div>
<div class="line">    DisplayRowValues(reader);</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md9"></a>
Reading Rows Using a Query with named Parameters</h3>
<p>If you need to specify the data-types of the parameters, e.g. if it can't be inferred from the .NET data type, or you need to specify the parameter direction (input or output), you can access the provider independent <code>DbCommand</code> object for the query and add parameters using methods on the <code>Database</code> object. You can add parameters with a specific direction using the <code>AddInParameter</code> or <code>AddOutParameter</code> method, or by using the <code>AddParameter</code> method and providing a value for the <code>ParameterDirection</code> parameter. You can change the value of existing parameters already added to the command using the <code>GetParameterValue</code> and <code>SetParameterValue</code> methods. </p><div class="fragment"><div class="line"><span class="comment">// Read data with a SQL statement that accepts one parameter prefixed with @.</span></div>
<div class="line"><span class="keywordtype">string</span> sqlStatement = <span class="stringliteral">&quot;SELECT TOP 1 * FROM OrderList WHERE State LIKE @state&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a suitable command type and add the required parameter.</span></div>
<div class="line"><span class="keyword">using</span> (DbCommand sqlCmd = defaultDB.GetSqlStringCommand(sqlStatement))</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Any required prefix, such as &#39;@&#39; or &#39;:&#39; will be added automatically if missing.</span></div>
<div class="line">    defaultDB.AddInParameter(sqlCmd, <span class="stringliteral">&quot;state&quot;</span>, DbType.String, <span class="stringliteral">&quot;New York&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Call the ExecuteReader method with the command.</span></div>
<div class="line">    <span class="keyword">using</span> (IDataReader sqlReader = defaultDB.ExecuteReader(sqlCmd))</div>
<div class="line">    {</div>
<div class="line">        DisplayRowValues(sqlReader);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Now read the same data with a stored procedure that accepts one parameter.</span></div>
<div class="line"><span class="keywordtype">string</span> storedProcName = <span class="stringliteral">&quot;ListOrdersByState&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a suitable command type and add the required parameter.</span></div>
<div class="line"><span class="keyword">using</span> (DbCommand sprocCmd = defaultDB.GetStoredProcCommand(storedProcName))</div>
<div class="line">{</div>
<div class="line">    defaultDB.AddInParameter(sprocCmd, <span class="stringliteral">&quot;state&quot;</span>, DbType.String, <span class="stringliteral">&quot;New York&quot;</span>);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Call the ExecuteReader method with the command.</span></div>
<div class="line">    <span class="keyword">using</span> (IDataReader sprocReader = defaultDB.ExecuteReader(sprocCmd))</div>
<div class="line">    {</div>
<div class="line">        DisplayRowValues(sprocReader);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md10"></a>
Retrieving Data as Objects</h3>
<p>DAAB allows you to extract data using a query, and have the data returned to you as a sequence of objects that implements the <code>IEnumerable</code> interface. This allows you to execute queries, or obtain lists or arrays of objects that represent the original data in the database.</p>
<p>The block provides two core classes for performing this kind of query: the <code>SprocAccessor</code> and the <code>SqlStringAccessor</code>. You can create and execute these accessors in one operation using the <code>ExecuteSprocAccessor</code> and <code>ExecuteSqlAccessor</code> extension methods of the <code>Database</code> class, or create a new accessor directly and then call its <code>Execute</code> method.</p>
<p>If you do not specify an output mapper, the block uses a default map builder class that maps the column names of the returned data to properties of the objects it creates. Alternatively, you can create a custom mapping to specify the relationship between columns in the row set and the properties of the objects. Inferring the details required to create the correct mappings means that the default output mappers <b>can have an effect on performance</b>. You may prefer to create your own custom mappers and retain a reference to them for reuse when possible to maximize performance of your data access processes when using accessors.</p>
<p>The following code shows how you can use an accessor to execute a stored procedure. You must specify the object type that you want the data returned as—in this example it is a simple class named <code>Product</code> that has the three properties: <code>ID</code>, <code>Name</code>, and <code>Description</code>.</p>
<p>The stored procedure takes a single parameter that is a search string, and returns details of all products in the database that contain this string. Therefore, the code calls the <code>ExecuteSprocAccessor</code> extension method passing the search string as the single parameter. It specifies the <code>Product</code> class as the type of object to return, and passes to the method the name of the stored procedure to execute and the array of parameter values.</p>
<div class="fragment"><div class="line"><span class="comment">// Create and execute a sproc accessor that uses the default</span></div>
<div class="line"><span class="comment">// parameter and output mappings.</span></div>
<div class="line">var productData = defaultDB.ExecuteSprocAccessor&lt;Product&gt;(<span class="stringliteral">&quot;GetProductList&quot;</span>, <span class="stringliteral">&quot;%bike%&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Display the results</span></div>
<div class="line"><span class="keywordflow">foreach</span> (var item <span class="keywordflow">in</span> results)</div>
<div class="line">{</div>
<div class="line">    Console.WriteLine(<span class="stringliteral">&quot;Product ID: {0}&quot;</span>, item.ID);</div>
<div class="line">    Console.WriteLine(<span class="stringliteral">&quot;Product Name: {0}&quot;</span>, item.Name);</div>
<div class="line">    Console.WriteLine(<span class="stringliteral">&quot;Description: {0}&quot;</span>, item.Description);</div>
<div class="line">    Console.WriteLine();</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
